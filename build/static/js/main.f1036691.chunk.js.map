{"version":3,"sources":["conductor/contexts.ts","conductor/BaseContainer.ts","product/modules/product/actions.ts","shared/react/Spinner.tsx","product/components/SomeLoaderAbstraction.tsx","product/containers/ProductDetailContainer.tsx","product/modules/product/selectors.ts","XApp.tsx","index.tsx"],"names":["__webpack_require__","d","__webpack_exports__","requestContext","provideContext","element","name","e","CustomEvent","bubbles","detail","dispatchEvent","context","data","addEventListener","stopPropagation","BaseContainer","_HTMLElement","_getPrototypeOf2","_this","Object","_Users_banderso_Code_micro_fe_poc_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","_len","arguments","length","args","Array","_key","_Users_banderso_Code_micro_fe_poc_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_banderso_Code_micro_fe_poc_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","call","apply","concat","subscription","_Users_banderso_Code_micro_fe_poc_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_inherits__WEBPACK_IMPORTED_MODULE_4__","_Users_banderso_Code_micro_fe_poc_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__","key","value","onConnected","closed","render","unsubscribe","onDisconnected","oldValue","newValue","shouldUpdate","_this2","merge","subscribe","_Users_banderso_Code_micro_fe_poc_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_wrapNativeSuper__WEBPACK_IMPORTED_MODULE_5__","HTMLElement","latency","duration","Promise","resolve","setTimeout","fetchProduct","_ref","asyncToGenerator","regenerator_default","a","mark","_callee","stream","_ref2","mockProduct","wrap","_context","prev","next","then","bind","sent","toConsumableArray","getValue","stop","_x","Spinner","react_default","createElement","SomeLoaderAbstraction","_React$Component","classCallCheck","possibleConstructorReturn","getPrototypeOf","inherits","createClass","props","needsData","alwaysFetchOnMount","fetchData","prevProps","fallback","children","React","Component","ProductDetail","lazy","all","ProductDetailContainer","_BaseContainer","productStream","subscribeTo","products","sku","product","find","p","ReactDOM","react","Spinner_Spinner","SomeLoaderAbstraction_SomeLoaderAbstraction","variantSku","tagName","customElements","define","XApp","ProductDetailContainer_ProductDetailContainer","rootEl","document","getElementById","cartStream","BehaviorSubject","appEl","appendChild"],"mappings":"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","file":"static/js/main.f1036691.chunk.js","sourcesContent":["\nconst EVENT_NAME = 'context-requested';\n\ninterface ContextRequestedDetail<ContextMap, K extends keyof ContextMap> {\n  name: K;\n  context?: ContextMap[K];\n};\n\nexport const requestContext = <ContextMap, K extends keyof ContextMap>(\n  element: HTMLElement, name: K,\n): ContextMap[K] | undefined => {\n  const e = new CustomEvent<ContextRequestedDetail<ContextMap, K>>(\n    EVENT_NAME, { bubbles: true, detail: { name } },\n  );\n  element.dispatchEvent(e);\n  return e.detail.context;\n};\n\nexport const provideContext = <ContextMap>(\n  element: HTMLElement, data: Partial<ContextMap>,\n) => {\n  const handler = (e: CustomEvent<ContextRequestedDetail<ContextMap, keyof ContextMap>>) => {\n    e.detail.context = data[e.detail.name];\n    e.stopPropagation();\n  };\n  element.addEventListener(EVENT_NAME, handler as EventListener);\n};\n","import { Subscription } from 'rxjs/internal/Subscription';\nimport { Observable } from 'rxjs/internal/Observable';\nimport { merge } from 'rxjs/internal/observable/merge';\n\nexport abstract class BaseContainer extends HTMLElement {\n\n  private subscription: Subscription | undefined;\n\n  private connectedCallback() {\n    this.onConnected();\n    if (!this.subscription || this.subscription.closed) {\n      this.render();\n    }\n  }\n\n  private disconnectedCallback() {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n    this.onDisconnected();\n  }\n\n  private attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null) {\n    if (this.shouldUpdate(name, oldValue, newValue)) {\n      this.render();\n    }\n  }\n\n  shouldUpdate(name: string, oldValue: string | null, newValue: string | null): boolean {\n    return true;\n  }\n\n  subscribeTo(...observables: Observable<any>[]) {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n    this.subscription = merge(...observables).subscribe(() => this.render());\n  }\n\n  onConnected() {}\n  render() {}\n  onDisconnected() {}\n}\n","import { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\nimport { Product } from './types';\n\nconst latency = (duration: number) => new Promise(resolve => setTimeout(resolve, duration));\n\nexport const fetchProduct = async (stream: BehaviorSubject<Product[]>) => {\n  await latency(300);\n  const { mockProduct } = await import('./mocks');\n  stream.next([ ...stream.getValue(), mockProduct ]);\n};\n","import React from 'react';\n\nexport const Spinner: React.FC = () => (\n  <div>loading...</div>\n);\n","import React from 'react';\n\ninterface SomeLoaderAbstractionProps {\n  fetchData: () => Promise<void>;\n  needsData: boolean;\n  fallback: JSX.Element;\n  alwaysFetchOnMount?: boolean;\n}\n\nexport class SomeLoaderAbstraction extends React.Component<SomeLoaderAbstractionProps> {\n  componentDidMount() {\n    if (this.props.needsData || this.props.alwaysFetchOnMount) {\n      this.props.fetchData();\n    }\n  }\n  componentDidUpdate(prevProps: SomeLoaderAbstractionProps) {\n    if (this.props.needsData && !prevProps.needsData) {\n      this.props.fetchData();\n    }\n  }\n  render() {\n    if (this.props.needsData) {\n      return this.props.fallback;\n    }\n    return this.props.children;\n  }\n}\n","import React from 'react';\nimport { BaseContainer } from 'conductor/BaseContainer';\nimport { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\nimport { Product } from 'product/modules/product/types';\nimport { requestContext } from 'conductor/contexts';\nimport { DependencyMap } from 'shared/config/DependencyMap';\nimport { fetchProduct } from 'product/modules/product/actions';\nimport { Suspense, lazy } from 'react';\nimport { Spinner } from 'shared/react/Spinner';\nimport ReactDOM from 'react-dom';\nimport { getProduct } from 'product/modules/product/selectors';\nimport { SomeLoaderAbstraction } from 'product/components/SomeLoaderAbstraction';\n\nconst ProductDetail = lazy(() => import('product/components/ProductDetail'));\n\nexport class ProductDetailContainer extends BaseContainer {\n  static tagName = 'product-detail-container';\n\n  productStream?: BehaviorSubject<Product[]>;\n\n  onConnected() {\n    // TODO: requestContext shouldn't need 'productStream' in the <> part\n    this.productStream = requestContext<DependencyMap, 'productStream'>(this, 'productStream');\n    if (this.productStream) {\n      this.subscribeTo(this.productStream);\n    }\n  }\n\n  // \"Bind\" action creators to the injected stream\n  fetchProduct = async () => {\n    if (this.productStream) {\n      await fetchProduct(this.productStream);\n    }\n  }\n\n  render() {\n    const { productStream } = this;\n    if (!productStream) {\n      return;\n    }\n\n    // These would probably come from the route in real life\n    const parentSku = 'tractor-parent-sku';\n    const variantSku = 't_fendt';\n\n    const product = getProduct(productStream.getValue(), parentSku);\n    ReactDOM.render(\n      <Suspense fallback={<Spinner />}>\n        <SomeLoaderAbstraction\n          fetchData={this.fetchProduct}\n          needsData={!product}\n          fallback={<Spinner />}\n        >\n          <ProductDetail product={product} variantSku={variantSku} />\n        </SomeLoaderAbstraction>\n      </Suspense>,\n      this,\n    );\n  }\n}\ncustomElements.define(ProductDetailContainer.tagName, ProductDetailContainer);\n","import { Product } from './types';\n\n// TODO: Memoize this somehow\n// e.g. reselect, lodash's memoize, custom function, whatever makes the most sense\nexport const getProduct = (products: Product[], sku: string): Product | undefined => {\n  return products.find(p => p.sku === sku);\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BaseContainer } from 'conductor/BaseContainer';\n\nimport { ProductDetailContainer } from 'product/containers/ProductDetailContainer';\n\nexport class XApp extends BaseContainer {\n  static tagName = 'x-app';\n  render() {\n    ReactDOM.render(\n      <ProductDetailContainer.tagName />,\n      this,\n    );\n  }\n}\ncustomElements.define(XApp.tagName, XApp);\n","import 'index.css';\nimport { provideContext } from 'conductor/contexts';\nimport { DependencyMap } from 'shared/config/DependencyMap';\nimport { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\nimport { Product } from 'product/modules/product/types';\nimport { XApp } from 'XApp';\nimport { CartItem } from 'checkout/modules/cart/types';\n\nconst rootEl = document.getElementById('root');\nif (rootEl) {\n  provideContext<DependencyMap>(rootEl, {\n    cartStream: new BehaviorSubject<CartItem[]>([]),\n    productStream: new BehaviorSubject<Product[]>([]),\n  });\n  const appEl = document.createElement(XApp.tagName);\n  rootEl.appendChild(appEl);\n}\n"],"sourceRoot":""}